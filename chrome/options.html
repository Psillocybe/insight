<!DOCTYPE html>
<html>
<head>
    <title>GitSense Configuration</title>
    <style>
        body { margin: 20px; font-size:13px;  }
        code { background-color:#fafafa; border:1px solid #ccc; padding:1px; border-radius:3px; }
        pre { font-size: 13px; font-family: monospace; }
        h2 { margin-bottom: 10px; }
        h3 { margin-top: 10px; margin-bottom: 5px; } 
        p { line-height: 1.5; font-size: 13px; }
        ol { line-height: 1.7; }
        input { padding: 3px; }
        .input-cell { display: table-cell }
        .input-status { width: 30px; display: none; }
        .button { padding-left: 10px; padding-right: 10px; }
        .note { margin-bottom: 5px }
        .reminder { 
            margin-top: 15px;
            margin-bottom: 20px;
            padding: 10px; 
            border: 1px solid #3c763d;
            width: 388px; 
            display: none;
            line-height: 1.5;
            background-color: #dff0d8;
            color: #3c763d;
            font-size: 13px;
        }
        .triangle {
            font-size: 12px;
            position: relative;
            top: -2px;
            width: 12px;
            text-align: center;
        }
        .plus-minus {
            font-size: 12px;
            position: relative;
            top: -2px;
            width: 12px;
            text-align: center;
        }
        .block-title {
            cursor: pointer;
        }
        .error { width: 595px; color: #a94442; background-color:#f2dede; padding:10px; margin-top:20px; }
        .rules { width: 500px; height: 400px; font-family: monospace; margin-top: 5px; }
        table { border: 1px solid #ccc; border-bottom: 0px; border-spacing: 0px; }
        td.attribute-name { 
            text-align:right; 
            padding: 10px;
            padding-right: 10px; 
            border-bottom: 1px solid #ccc;
            border-right: 1px solid #ccc;
            vertical-align: top;
        }
        td.attribute-desc {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        td.sub-attribute-name { 
            text-align:right; 
            padding: 5px;
            padding-top: 0px;
            vertical-align: top;
        }
        td.sub-attribute-desc { padding: 5px; padding-top: 0px; }
    </style> 
    <link rel="stylesheet" type="text/css" href="3rdparty/octicons/octicons.css"> 
</head>
<body>
    <h1>GitSense Configuration</h1>

    <h2>
        Page Rules
    </h2>
    <div style="width:700px;margin-bottom:10px;">
        <h3 class="block">
            <span class="octicon octicon-triangle-right triangle" style="font-size:12px;"></span>
            <span class="block-title">Description</span>
        </h3>
        <div class="block block-body" style="display:none">
            <p style="margin-top:0px;">
            Page rules, which consists of one or more page objects (described below), are used by GitSense to determine the
            current page type and required API servers.&nbsp;
            <br> 
            <br>
            <strong>Page object</strong><br>
            <table style="margin-top:5px;">
                <tr>
                    <td class=attribute-name>matches</td>
                    <td class=attribute-desc>
                        A string containing a URL pattern to match against the current page location.
                    </td>
                </tr>
                <tr>
                    <td class=attribute-name>type</td>
                    <td class=attribute-desc>
                        A string containing one of the following page types:
                        <ul>
                            <li>bitbucket</li>
                            <li>github</li>
                            <li>github-enterprise</li>
                        </ul> 
                    </td>
                </tr>
                <tr>
                    <td class=attribute-name>gitsense</td>
                    <td class=attribute-desc>
                        An object containing the following attributes:
                        <table style="margin-top:10px;border:0px;line-height:1.5">
                            <tr>
                                <td class=sub-attribute-name>api:</td>
                                <td class=sub-attribute-desc>
                                    A string containing a URL to the GitSense API server
                                </td>
                            </tr>
                            <tr>
                                <td class=sub-attribute-name>secret:</td>
                                <td class=sub-attribute-desc>
                                    An OPTIONAL string containing an access token for the GitSense server.&nbsp; Note a secret is only required if authentication has been enabled on the GitSense server.</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td class=attribute-name>host</td>
                    <td class=attribute-desc>
                        An object containing the following attributes:
                        <table style="margin-top:10px;border:0px;line-height:1.5">
                            <tr>
                                <td class=sub-attribute-name>api:</td>
                                <td class=sub-attribute-desc>
                                    A string containing a URL to the Bitbucket/GitHub/GitHub Enterprise API server. 
                                </td>
                            </tr>
                            <tr>
                                <td class=sub-attribute-name>secret:</td>
                                <td class=sub-attribute-desc>
                                    An OPTIONAL string containing your access token (for GitHub/GitHub Enterprise) or API key (for Bitbucket).&nbsp;
                                    To view <b>PRIVATE</b> repositories with GitSense, you'll have to specify a secret, as it is used to query the host API to verify your repository read permission.
                                    <br>
                                    <br>
                                    <strong>Security</strong><br>
                                    You should only use GitHub access tokens that have "repo" scope and nothing more.&nbsp;
                                    That is, don't use access tokens that have "user" privilege among other things.&nbsp;
                                    For API keys (Bitbucket), you can't and don't have to worry about changing their scope, as the scope is limited by default.
                            </tr>
                        </table>

                    </td>
                </tr>
            </table> 
        </div>
        <h3 class="block">
            <span class="octicon octicon-triangle-right triangle" style="font-size:12px;"></span>
            <span class="block-title">Example</span>
        </h3>
        <div class="block block-body" style="display:none;">
        <p>
            <strong>Rule 1</strong><br>
            Rule 1 will match repositories that are owned by the Bitbucket team "johndohh-team". &nbsp;
            It also tells GitSense to use a private GitSense install, which is accessible from the local area network (192.168.1.2).&nbsp;
            And it provides a secret (an API key), that can be used to query the Bitbucket API server (https://api.bitbucket.org), to verify the users read permission.<br>
            <br>
            <strong>Rule 2</strong><br>
            Rule 2 will match all other Bitbucket repositories that are not owned by "johndohh-team".&nbsp;
            This rule also tells GitSense to use the publicly available GitSense server (https://api.gitsense.com).<br>
            <br>
            <strong>Rule 3</strong><br>
            Rule 3 will match all GitHub repositories and because no secret was provided, GitSense will not work for PRIVATE GitHub repositories.<br>
            <br>
            <strong>Rule 4</strong><br>
            Rule 4 will match all repositories on a local GitHub Enterprise install (192.168.1.1).&nbsp;
            It also provides a secret (token access), which can be used by GitSense to query the GitHub Enterprise API (https://192.168.1.1/api/v3), to verify their repository read permission.&nbsp;
            And it uses a private GitSense install, which is accessible from their local area network (https://192.168.1.2).<br>
        </p>
<pre style="border:1px solid #ccc;padding:10px;">
[
    {
        "type": "bitbucket",
        "matches": "https://bitbucket.org/johndohh-team/*",
        "gitsense": {
            "api": "https://192.168.1.2",
            "secret": "mKAhnHdBYfByJNrvQbdV1Bf5lyXoKnQGTcbM62c2"
        }, 
        "host": {
            "api": "https://api.bitbucket.org",
            "secret": "mgw2iXO06WdqvqR2WeeTBGkypaQDKBQb"
        }
    },
    {
        "type": "bitbucket",
        "matches": "https://bitbucket.org/*", 
        "gitsense": {
            "api": "https://api.gitsense.com"
        }, 
        "host": {
            "api": "https://api.bitbucket.org"
        }
    },
    {
        "type": "github",
        "matches": "https://github.com/*",
        "gitsense": {
            "api": "https://api.gitsense.com"
        },
        "host": {
            "api": "https://api.github.com"
        }
    },
    {
        "type": "github-enterprise",
        "matches": "https://192.168.1.1/*",
        "gitsense": {
            "api": "https://192.168.1.2",
            "secret": "mKAhnHdBYfByJNrvQbdV1Bf5lyXoKnQGTcbM62c2"
        }
        "host": {
            "api": "https://192.168.1.1/api/v3",
            "secret": "e9c8233e94a7993fd47975f62296a8f68604d3b8"
        }
    }
]
</pre>
        </div>
        <h3 class="block">
            <span class="octicon octicon-triangle-down triangle" style="font-size:12px;"></span>
            <span class="block-title">Rules</span>
        </h3>
        <div class="block block-cell">
            <textarea id=page_rules-input class=rules></textarea>
        </div>
    </div>   

    <input class=button id=save-button type=button value="Save" disabled>
    <span id=save-status style="margin-left:5px"></span>
    <div id=save-error class=error style="display:none;"></div>
    <div class=reminder>
        <h3 style="margin-top:0px;">Need to update manifest.json file?</h3>
        If required, remember to update the <b>permissions</b> and <b>matches</b> value 
        in the manifest.json file and to reload the extension.
    </div>

    <script src="js/arch.js"></script>
    <script src="js/config.js"></script>
    <script src="options.js"></script>
</body>
</html>
